- fix EOF handling
- detect invalid sequence
